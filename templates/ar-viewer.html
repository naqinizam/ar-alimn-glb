<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>AR Chair Viewer</title>
    <style>
        #debug {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            font-family: monospace;
            z-index: 9999;
        }
    </style>
</head>
<body style="margin: 0;">
    <div id="debug">Initializing AR...</div>

    <!-- Load A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <!-- AR Scene -->
    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; detectionMode: mono; debugUIEnabled: true; trackingMethod: best;"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        embedded>

        <!-- Model with ERROR EVENT LISTENER -->
        <a-entity
            id="chair"
            gltf-model="url(/models/chair.glb)"
            scale="0.3 0.3 0.3"
            position="0 0 -1"
            rotation="0 180 0"
            arjs-anchor
            events="model-error: onModelError; model-loaded: onModelLoaded">
        </a-entity>

        <a-camera-static></a-camera-static>
    </a-scene>

    <script>
    const debug = document.getElementById('debug');

    // Model event handlers
    function onModelLoaded() {
        debug.textContent += "\nâœ… Chair model loaded! Move your phone.";
        console.log("Model loaded successfully");
    }

    function onModelError(evt) {
        const error = evt.detail || {};
        debug.textContent += `\nâŒ Model failed: ${error.message || "Unknown error"}`;
        console.error("Model error:", error);

        // Fallback to a known-working model
        debug.textContent += "\nâš ï¸ Trying fallback model...";
        document.getElementById('chair').setAttribute('gltf-model', {
            src: 'url(https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Chair/glTF-Binary/Chair.glb)',
            crossorigin: 'anonymous'
        });
    }

    // AR.js initialization check
    document.querySelector('a-scene').addEventListener('arjs-video-loaded', () => {
        debug.textContent += "\nðŸ“· Camera ready - scan a surface";
    });
    </script>
</body>
</html>